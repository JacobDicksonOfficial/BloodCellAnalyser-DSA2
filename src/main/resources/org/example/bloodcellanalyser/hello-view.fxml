<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>
<?import javafx.scene.text.Text?>
<?import javafx.scene.effect.DropShadow?>
<?import javafx.scene.paint.Color?>

<BorderPane xmlns="http://javafx.com/javafx/8" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="org.example.bloodcellanalyser.controllers.MainController"
            stylesheets="@/org/example/bloodcellanalyser/application.css">

    <top>
        <VBox alignment="CENTER" styleClass="header-panel">
            <padding>
                <Insets top="15" right="20" bottom="15" left="20"/>
            </padding>
            <HBox alignment="CENTER_LEFT" spacing="15">
                <Text styleClass="app-title" text="Blood Cell Analyzer"/>
                <Pane HBox.hgrow="ALWAYS" />
            </HBox>
        </VBox>
    </top>

    <center>
        <VBox spacing="15">
            <padding>
                <Insets top="20" right="20" bottom="20" left="20"/>
            </padding>

            <!-- Control Bar -->
            <HBox spacing="10" alignment="CENTER_LEFT" styleClass="control-bar">
                <padding>
                    <Insets top="10" right="10" bottom="10" left="10"/>
                </padding>
                <Button text="Open Image" onAction="#openImage" styleClass="action-button">
                    <graphic>
                        <Text text="ðŸ“‚" />
                    </graphic>
                </Button>
                <Button text="Convert to Tri-color" onAction="#convertToTricolor" styleClass="action-button">
                    <graphic>
                        <Text text="ðŸŽ¨" />
                    </graphic>
                </Button>
                <Button text="Analyze Cells" onAction="#analyzeCells" styleClass="action-button">
                    <graphic>
                        <Text text="ðŸ”" />
                    </graphic>
                </Button>
                <Separator orientation="VERTICAL" />
                <ToggleButton fx:id="toggleLabels" text="Show Labels" onAction="#toggleLabelsAction" styleClass="toggle-button" />
                <Pane HBox.hgrow="ALWAYS" />
                <ProgressIndicator fx:id="progressIndicator" visible="false" />
            </HBox>

            <!-- Image Displays -->
            <GridPane hgap="20" vgap="10" alignment="CENTER">
                <columnConstraints>
                    <ColumnConstraints hgrow="SOMETIMES" percentWidth="33.3" />
                    <ColumnConstraints hgrow="SOMETIMES" percentWidth="33.3" />
                    <ColumnConstraints hgrow="SOMETIMES" percentWidth="33.3" />
                </columnConstraints>

                <VBox spacing="5" alignment="CENTER" styleClass="image-container" GridPane.columnIndex="0">
                    <Label text="Original Image" styleClass="section-label" />
                    <StackPane styleClass="image-wrapper">
                        <ImageView fx:id="originalView" fitWidth="400" fitHeight="300" preserveRatio="true" />
                        <Text fx:id="dropImageHint" text="Drop image here or use Open button" styleClass="drop-hint" visible="true" />
                    </StackPane>
                </VBox>

                <VBox spacing="5" alignment="CENTER" styleClass="image-container" GridPane.columnIndex="1">
                    <Label text="Tri-Color Image" styleClass="section-label" />
                    <StackPane styleClass="image-wrapper">
                        <ImageView fx:id="tricolorView" fitWidth="400" fitHeight="300" preserveRatio="true" />
                    </StackPane>
                </VBox>

                <VBox spacing="5" alignment="CENTER" styleClass="image-container" GridPane.columnIndex="2">
                    <Label text="Result Image" styleClass="section-label" />
                    <StackPane styleClass="image-wrapper">
                        <ImageView fx:id="resultView" fitWidth="400" fitHeight="300" preserveRatio="true" />
                    </StackPane>
                </VBox>
            </GridPane>

            <!-- Lower Panel -->
            <TitledPane text="Analysis Tools" expanded="true" styleClass="analysis-panel">
                <content>
                    <HBox spacing="20">
                        <VBox spacing="10" HBox.hgrow="ALWAYS">
                            <Label text="Analysis Results" styleClass="section-label" />
                            <TableView fx:id="resultsTable" prefHeight="200">
                                <columns>
                                    <TableColumn text="Cell Type" fx:id="cellTypeColumn" prefWidth="150" />
                                    <TableColumn text="Count" fx:id="countColumn" prefWidth="100" />
                                    <TableColumn text="Percentage" fx:id="percentageColumn" prefWidth="150" />
                                </columns>
                            </TableView>
                            <ListView fx:id="infoList" prefHeight="120" visible="false" managed="false" />
                        </VBox>

                        <VBox spacing="10" minWidth="300" maxWidth="400">
                            <Label text="Threshold Settings" styleClass="section-label" />

                            <TitledPane text="Hue" expanded="false" styleClass="slider-pane">
                                <content>
                                    <VBox spacing="5">
                                        <Slider fx:id="hueS" min="0" max="360" value="20" blockIncrement="1" showTickMarks="true" />
                                        <HBox alignment="CENTER_LEFT" spacing="10">
                                            <Label text="Value:" />
                                            <TextField fx:id="hueValue" prefWidth="60" editable="true" />
                                            <Button text="Reset" fx:id="resetHue" styleClass="reset-button" />
                                        </HBox>
                                    </VBox>
                                </content>
                            </TitledPane>

                            <TitledPane text="Saturation" expanded="false" styleClass="slider-pane">
                                <content>
                                    <VBox spacing="5">
                                        <Slider fx:id="satS" min="0" max="1" value="0.2" blockIncrement="0.01" showTickMarks="true" />
                                        <HBox alignment="CENTER_LEFT" spacing="10">
                                            <Label text="Value:" />
                                            <TextField fx:id="satValue" prefWidth="60" editable="true" />
                                            <Button text="Reset" fx:id="resetSat" styleClass="reset-button" />
                                        </HBox>
                                    </VBox>
                                </content>
                            </TitledPane>

                            <TitledPane text="Brightness" expanded="false" styleClass="slider-pane">
                                <content>
                                    <VBox spacing="5">
                                        <Slider fx:id="brightS" min="0" max="1" value="0.4" blockIncrement="0.01" showTickMarks="true" />
                                        <HBox alignment="CENTER_LEFT" spacing="10">
                                            <Label text="Value:" />
                                            <TextField fx:id="brightValue" prefWidth="60" editable="true" />
                                            <Button text="Reset" fx:id="resetBright" styleClass="reset-button" />
                                        </HBox>
                                    </VBox>
                                </content>
                            </TitledPane>

                            <HBox alignment="CENTER_RIGHT" spacing="10">
                                <Button text="Apply Settings" fx:id="applySettings" styleClass="apply-button" />
                                <Button text="Reset All" fx:id="resetAll" onAction="#handleResetAll" styleClass="reset-all-button" />
                            </HBox>
                        </VBox>
                    </HBox>
                </content>
            </TitledPane>
        </VBox>
    </center>

    <bottom>
        <HBox alignment="CENTER_LEFT" styleClass="status-bar">
            <padding>
                <Insets top="5" right="10" bottom="5" left="10"/>
            </padding>
            <Label fx:id="statusLabel" text="Ready" />
            <Pane HBox.hgrow="ALWAYS" />
            <Label fx:id="imageInfoLabel" text="No image loaded" />
        </HBox>
    </bottom>

</BorderPane>